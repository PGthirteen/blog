(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{582:function(e,s,n){"use strict";n.r(s);var a=n(0),t=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"react中refs的理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react中refs的理解"}},[e._v("#")]),e._v(" React中refs的理解")]),e._v(" "),s("p",[s("code",[e._v("Refs")]),e._v("提供了一种方式，允许我们访问"),s("code",[e._v("DOM")]),e._v("节点或在"),s("code",[e._v("render")]),e._v("方法中创建的"),s("code",[e._v("React")]),e._v("元素。")]),e._v(" "),s("h2",{attrs:{id:"描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[e._v("#")]),e._v(" 描述")]),e._v(" "),s("p",[e._v("在典型的"),s("code",[e._v("React")]),e._v("数据流中，"),s("code",[e._v("props")]),e._v("是父组件与子组件交互的唯一方式，要修改一个子组件，你需要使用新的"),s("code",[e._v("props")]),e._v("来重新渲染它，但是在某些情况下，你需要在典型数据流之外强制修改子组件，被修改的子组件可能是一个"),s("code",[e._v("React")]),e._v("组件的实例，也可能是一个"),s("code",[e._v("DOM")]),e._v("元素，对于这两种情况"),s("code",[e._v("React")]),e._v("都提供了解决办法。"),s("br"),e._v("\n避免使用"),s("code",[e._v("refs")]),e._v("来做任何可以通过声明式实现来完成的事情，通常在可以使用"),s("code",[e._v("props")]),e._v("与"),s("code",[e._v("state")]),e._v("的情况下勿依赖"),s("code",[e._v("refs")]),e._v("，下面是几个适合使用"),s("code",[e._v("refs")]),e._v("的情况:")]),e._v(" "),s("ul",[s("li",[e._v("管理焦点、文本选择或媒体播放。")]),e._v(" "),s("li",[e._v("触发强制动画。")]),e._v(" "),s("li",[e._v("集成第三方"),s("code",[e._v("DOM")]),e._v("库。")])]),e._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),s("p",[s("code",[e._v("React")]),e._v("提供的这个"),s("code",[e._v("ref")]),e._v("属性，表示为对组件真正实例的引用，其实就是"),s("code",[e._v("ReactDOM.render()")]),e._v("返回的组件实例，需要区分一下渲染组件与渲染原生"),s("code",[e._v("DOM")]),e._v("元素，渲染组件时返回的是组件实例，而渲染"),s("code",[e._v("DOM")]),e._v("元素时，返回是具体的"),s("code",[e._v("DOM")]),e._v("节点，"),s("code",[e._v("React")]),e._v("的"),s("code",[e._v("ref")]),e._v("有"),s("code",[e._v("3")]),e._v("种用法。")]),e._v(" "),s("h3",{attrs:{id:"字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字符串"}},[e._v("#")]),e._v(" 字符串")]),e._v(" "),s("p",[s("code",[e._v("ref")]),e._v("可以直接设置为字符串值，这种方式基本不推荐使用，或者在未来的"),s("code",[e._v("React")]),e._v("版本中不会再支持该方式。这主要是因为使用字符串导致的一些问题，例如当"),s("code",[e._v("ref")]),e._v("定义为"),s("code",[e._v("string")]),e._v("时，需要"),s("code",[e._v("React")]),e._v("追踪当前正在渲染的组件，在"),s("code",[e._v("reconciliation")]),e._v("阶段，"),s("code",[e._v("React Element")]),e._v("创建和更新的过程中，"),s("code",[e._v("ref")]),e._v("会被封装为一个闭包函数，等待"),s("code",[e._v("commit")]),e._v("阶段被执行，这会对"),s("code",[e._v("React")]),e._v("的性能产生一些影响等。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('class InputOne extends React.Component {\n    componentDidMount() {\n        this.refs.inputRef.value = 1;\n      }\n    render() {\n        return <input ref="inputRef" />;\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h3",{attrs:{id:"回调"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回调"}},[e._v("#")]),e._v(" 回调")]),e._v(" "),s("p",[s("code",[e._v("React")]),e._v("支持给任意组件添加特殊属性，"),s("code",[e._v("ref")]),e._v("属性接受一个回调函数，其在组件被加载或卸载时会立即执行。")]),e._v(" "),s("ul",[s("li",[e._v("当给"),s("code",[e._v("HTML")]),e._v("元素添加"),s("code",[e._v("ref")]),e._v("属性时，"),s("code",[e._v("ref")]),e._v("回调接收了底层的"),s("code",[e._v("DOM")]),e._v("元素作为参数。")]),e._v(" "),s("li",[e._v("当给组件添加"),s("code",[e._v("ref")]),e._v("属性时，"),s("code",[e._v("ref")]),e._v("回调接收当前组件实例作为参数。")]),e._v(" "),s("li",[e._v("当组件卸载的时候，会传入"),s("code",[e._v("null")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("ref")]),e._v("回调会在"),s("code",[e._v("componentDidMount")]),e._v("或"),s("code",[e._v("componentDidUpdate")]),e._v("等生命周期回调之前执行。")])]),e._v(" "),s("p",[s("code",[e._v("Callback Ref")]),e._v("我们通常会使用内联函数的形式，那么每次渲染都会重新创建，由于"),s("code",[e._v("React")]),e._v("会清理旧的"),s("code",[e._v("ref")]),e._v("然后设置新的，因此更新期间会调用两次，第一次为"),s("code",[e._v("null")]),e._v("，如果在"),s("code",[e._v("Callback")]),e._v("中带有业务逻辑的话，可能会出错，可以通过将"),s("code",[e._v("Callback")]),e._v("定义成类成员函数并进行绑定的方式避免。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("class InputTwo extends React.Component {\n    componentDidMount() {\n        this.inputRef.value = 2;\n      }\n    render() {\n        return <input ref={(element) =>this.inputRef = element} />;\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h3",{attrs:{id:"api创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api创建"}},[e._v("#")]),e._v(" API创建")]),e._v(" "),s("p",[e._v("在"),s("code",[e._v("React v16.3")]),e._v("中经"),s("code",[e._v("0017-new-create-ref")]),e._v("提案引入了新的"),s("code",[e._v("React.createRef")]),e._v("的"),s("code",[e._v("API")]),e._v("，当"),s("code",[e._v("ref")]),e._v("被传递给"),s("code",[e._v("render")]),e._v("中的元素时，对该节点的引用可以在"),s("code",[e._v("ref")]),e._v("的"),s("code",[e._v("current")]),e._v("属性中被访问，"),s("code",[e._v("ref")]),e._v("的值根据节点的类型而有所不同：")]),e._v(" "),s("ul",[s("li",[e._v("当"),s("code",[e._v("ref")]),e._v("属性用于"),s("code",[e._v("HTML")]),e._v("元素时，构造函数中使用"),s("code",[e._v("React.createRef()")]),e._v("创建的"),s("code",[e._v("ref")]),e._v("接收底层"),s("code",[e._v("DOM")]),e._v("元素作为其"),s("code",[e._v("current")]),e._v("属性。")]),e._v(" "),s("li",[e._v("当"),s("code",[e._v("ref")]),e._v("属性用于自定义"),s("code",[e._v("class")]),e._v("组件时，"),s("code",[e._v("ref")]),e._v("对象接收组件的挂载实例作为其"),s("code",[e._v("current")]),e._v("属性。")]),e._v(" "),s("li",[e._v("不能在函数组件上使用"),s("code",[e._v("ref")]),e._v("属性，因为他们没有实例。")])]),e._v(" "),s("p",[e._v("对比新的"),s("code",[e._v("CreateRef")]),e._v("与"),s("code",[e._v("Callback Ref")]),e._v("，并没有压倒性的优势，只是希望成为一个便捷的特性，在性能上会会有微小的优势，"),s("code",[e._v("Callback Ref")]),e._v("采用了组件"),s("code",[e._v("Render")]),e._v("过程中在闭包函数中分配"),s("code",[e._v("ref")]),e._v("的模式，而"),s("code",[e._v("CreateRef")]),e._v("则采用了"),s("code",[e._v("Object Ref")]),e._v("。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("class InputThree extends React.Component {\n    constructor(props) {\n        super(props);\n        this.inputRef = React.createRef();\n    }\n    componentDidMount() {\n        this.inputRef.current.value = 3;\n    }\n    render() {\n        return <input ref={this.inputRef} />;\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("h2",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[e._v("#")]),e._v(" 示例")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('<!DOCTYPE html>\n<html>\n\n<head>\n    <meta charset="UTF-8" />\n    <title>React</title>\n</head>\n\n<body>\n    <div id="root"></div>\n</body>\n<script src="https://unpkg.com/react@17/umd/react.development.js"><\/script>\n<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"><\/script>\n<script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>\n<script type="text/babel">\n    class InputOne extends React.Component {\n        componentDidMount() {\n            this.refs.inputRef.value = 1;\n          }\n        render() {\n            return <input ref="inputRef" />;\n        }\n    }\n\n    class InputTwo extends React.Component {\n        componentDidMount() {\n            this.inputRef.value = 2;\n          }\n        render() {\n            return <input ref={(element) =>this.inputRef = element} />;\n        }\n    }\n\n    class InputThree extends React.Component {\n        constructor(props) {\n            super(props);\n            this.inputRef = React.createRef();\n        }\n        componentDidMount() {\n            this.inputRef.current.value = 3;\n        }\n        render() {\n            return <input ref={this.inputRef} />;\n        }\n    }\n    \n\n    var vm = ReactDOM.render(\n        <>\n            <InputOne />\n            <InputTwo />\n            <InputThree />\n        </>,\n        document.getElementById("root")\n    );\n<\/script>\n\n</html>\n\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br"),s("span",{staticClass:"line-number"},[e._v("38")]),s("br"),s("span",{staticClass:"line-number"},[e._v("39")]),s("br"),s("span",{staticClass:"line-number"},[e._v("40")]),s("br"),s("span",{staticClass:"line-number"},[e._v("41")]),s("br"),s("span",{staticClass:"line-number"},[e._v("42")]),s("br"),s("span",{staticClass:"line-number"},[e._v("43")]),s("br"),s("span",{staticClass:"line-number"},[e._v("44")]),s("br"),s("span",{staticClass:"line-number"},[e._v("45")]),s("br"),s("span",{staticClass:"line-number"},[e._v("46")]),s("br"),s("span",{staticClass:"line-number"},[e._v("47")]),s("br"),s("span",{staticClass:"line-number"},[e._v("48")]),s("br"),s("span",{staticClass:"line-number"},[e._v("49")]),s("br"),s("span",{staticClass:"line-number"},[e._v("50")]),s("br"),s("span",{staticClass:"line-number"},[e._v("51")]),s("br"),s("span",{staticClass:"line-number"},[e._v("52")]),s("br"),s("span",{staticClass:"line-number"},[e._v("53")]),s("br"),s("span",{staticClass:"line-number"},[e._v("54")]),s("br"),s("span",{staticClass:"line-number"},[e._v("55")]),s("br"),s("span",{staticClass:"line-number"},[e._v("56")]),s("br"),s("span",{staticClass:"line-number"},[e._v("57")]),s("br"),s("span",{staticClass:"line-number"},[e._v("58")]),s("br"),s("span",{staticClass:"line-number"},[e._v("59")]),s("br")])]),s("h2",{attrs:{id:"每日一题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#每日一题"}},[e._v("#")]),e._v(" 每日一题")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("https://github.com/WindrunnerMax/EveryDay\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("https://zhuanlan.zhihu.com/p/40462264\nhttps://www.jianshu.com/p/4e2357ea1ba1\nhttps://juejin.cn/post/6844903809274085389\nhttps://juejin.cn/post/6844904048882106375\nhttps://segmentfault.com/a/1190000008665915\nhttps://zh-hans.reactjs.org/docs/refs-and-the-dom.html\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);